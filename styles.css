/* Base document styles and theme variables */
:root {
  --gb-light: #9bbc0f;
  --gb-mid:   #8bac0f;
  --gb-deep:  #306230;
  --gb-dark:  #0f380f;
  --dmg-body: #d9d6cf;
  --dmg-body-2: #cfcac2;
  --btn-plum: #7b3f61;
  --btn-plum-dark: #5a2d47;
  --dpad: #404852;
  --text: #0f172a;
  --screen-text: #0b250b;
  --shadow: 0 14px 40px rgba(0,0,0,.35);
  --radius: 16px;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  position: relative;
  overflow: hidden;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  color: var(--text);
  display: grid;
  place-items: center;
  padding: 32px;
  isolation: isolate;
}

/* Film grain/scanline overlays (gated by .effects-on) */
@keyframes grainShift { 0% { background-position: 0 0; } 100% { background-position: 256px 192px; } }
@keyframes scanFlicker { 0%,100% { opacity: .55; } 45% { opacity: .65; } 50% { opacity: .50; } 55% { opacity: .66; } 80% { opacity: .60; } }
@keyframes filmJitter { 0% { transform: translate(0,0); } 20% { transform: translate(-0.5px, 0.4px); } 40% { transform: translate(0.6px,-0.3px); } 60% { transform: translate(-0.3px,-0.6px); } 80% { transform: translate(0.4px,0.5px); } 100% { transform: translate(0,0); } }

/* Only render overlays when effects are enabled */
body.effects-on::before {
  content: "";
  position: fixed;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  mix-blend-mode: screen;
  opacity: .55;
  background-image:
    url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='128' height='128'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' stitchTiles='stitch'/></filter><rect width='100%' height='100%' filter='url(%23n)' opacity='0.28'/></svg>");
  background-size: 256px 256px;
  animation: grainShift 0.9s steps(8) infinite, filmJitter 2.2s ease-in-out infinite;
  will-change: background-position, opacity;
}

body.effects-on::after {
  content: "";
  position: fixed;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  opacity: .85;
  mix-blend-mode: multiply;
  background:
    linear-gradient(0deg, rgba(255,214,170,.08), rgba(255,214,170,.08)),
    radial-gradient(120% 80% at 50% -20%, rgba(255,255,255,.06), transparent 60%),
    radial-gradient(100% 120% at 50% 120%, rgba(0,0,0,.55), transparent 55%),
    repeating-linear-gradient(0deg, rgba(0,0,0,.16) 0 1px, rgba(0,0,0,0) 1px 3px);
  background-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%;
  backdrop-filter: saturate(0.9) contrast(1.06) brightness(0.96);
  animation: scanFlicker 6s ease-in-out infinite, filmJitter 2.2s ease-in-out infinite;
}

/* Blurred arcade background (no external image to avoid 404/weight) */
.bg {
  position: fixed;
  inset: 0;
  z-index: -3;
  background: radial-gradient(1200px 800px at 20% 10%, #2b2b44 0%, #0d0f17 60%);
  filter:
    blur(14px)
    brightness(0.55)
    saturate(1.25)
    drop-shadow(0.3px 0 0 rgba(255, 0, 0, 0.09))
    drop-shadow(-0.3px 0 0 rgba(0, 0, 255, 0.09))
    drop-shadow(0 0.3px 0 rgba(0, 255, 0, 0.06));
  transform: scale(1.08);
}
.bg::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(0,0,0,.2), rgba(0,0,0,.45));
}

.glbg, .trail {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  display: none; /* hidden until effects are enabled */
}
.effects-on .glbg, .effects-on .trail { display: block; }

.calc {
  width: 100%;
  max-width: 380px;
  background: linear-gradient(180deg, var(--dmg-body) 0%, var(--dmg-body-2) 100%);
  border-radius: var(--radius);
  box-shadow:
    var(--shadow),
    inset -12px 0 16px rgba(0,0,0,.17),
    inset 0 -12px 18px rgba(0,0,0,.22),
    inset 1px 0 0 rgba(255,255,255,.14),
    inset 0 1px 0 rgba(255,255,255,.16);
  border: 1px solid rgba(0,0,0,.08);
  padding: 14px 14px 10px;
  position: relative;
  z-index: 2;
}
.has-3d-effect.calc {
  box-shadow:
    var(--shadow),
    inset -14px 0 18px rgba(0,0,0,.16),
    inset 0 -14px 20px rgba(0,0,0,.20),
    inset 1px 0 0 rgba(255,255,255,.16),
    inset 0 1px 0 rgba(255,255,255,.18),
    inset 0 0 0 1px rgba(255,255,255,.06);
  background-image:
    linear-gradient(180deg, var(--dmg-body) 0%, var(--dmg-body-2) 100%),
    radial-gradient(120% 80% at 15% 0%, rgba(255,255,255,.05), transparent 55%),
    radial-gradient(120% 90% at 100% 120%, rgba(0,0,0,.05), transparent 60%);
  background-blend-mode: normal, overlay, multiply;
}

.has-3d-effect .keys button {
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.18),
    inset 0 -3px 6px rgba(0,0,0,.22),
    0 1px 0 rgba(255,255,255,.04);
}
.has-3d-effect .keys .op,
.has-3d-effect .keys .eq,
.has-3d-effect .keys .fn {
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.14),
    inset 0 -3px 6px rgba(0,0,0,.28),
    0 1px 0 rgba(255,255,255,.03);
}

.has-3d-effect .bezel {
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.16),
    inset 0 -3px 10px rgba(0,0,0,.38),
    inset 2px 0 6px rgba(0,0,0,.14),
    inset -2px 0 6px rgba(255,255,255,.06);
}
.has-3d-effect .display {
  box-shadow:
    inset 0 0 0 2px rgba(255,255,255,.10),
    inset 0 -8px 18px rgba(0,0,0,.18),
    0 0 18px rgba(139,172,15,.12);
  background-image:
    linear-gradient(180deg, var(--gb-light), var(--gb-mid)),
    repeating-linear-gradient(45deg, rgba(0,0,0,.02) 0 2px, rgba(255,255,255,.02) 2px 4px);
  background-blend-mode: normal, overlay;
}

.bezel {
  position: relative;
  border-radius: 14px;
  padding: 10px;
  background: linear-gradient(165deg, #2a2f3f 0%, #1a1e2a 55%, #121623 100%);
  border: 1px solid rgba(255,255,255,.05);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.14),
    inset 0 -2px 8px rgba(0,0,0,.45),
    inset 2px 0 6px rgba(0,0,0,.18),
    inset -2px 0 6px rgba(255,255,255,.08);
}
.bezel::after {
  content: "";
  position: absolute;
  inset: 6px;
  border-radius: 10px;
  pointer-events: none;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.10),
    inset 0 -2px 6px rgba(0,0,0,.35);
}

.display {
  padding: 16px 16px 10px;
  min-height: 110px;
  display: grid;
  align-content: end;
  gap: 6px;
  background: linear-gradient(180deg, var(--gb-light), var(--gb-mid));
  border-radius: 10px;
  position: relative;
  border: 2px solid var(--gb-deep);
  box-shadow:
    inset 0 0 0 2px rgba(255,255,255,.12),
    inset 0 -8px 20px rgba(0,0,0,.15),
    0 0 22px rgba(155,188,15,.28),
    0 0 42px rgba(139,172,15,.18);
  filter: contrast(1.02) saturate(1.05) brightness(1.02);
}
.hud {
  position: absolute;
  top: 6px;
  left: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
  pointer-events: none;
  opacity: 0.95;
  mix-blend-mode: multiply;
}
.battery {
  --level: 0.75;
  position: relative;
  width: 38px;
  height: 16px;
  border: 2px solid var(--gb-deep);
  border-radius: 3px;
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(0,0,0,.06));
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.18), inset 0 -2px 6px rgba(0,0,0,.08);
}
.battery::after {
  content: "";
  position: absolute;
  right: -6px;
  top: 4px;
  width: 4px;
  height: 8px;
  background: var(--gb-deep);
  border-radius: 1px;
  box-shadow: 0 0 0 1px rgba(255,255,255,.15) inset;
}
.battery-level {
  position: absolute;
  left: 2px;
  top: 2px;
  bottom: 2px;
  width: calc((100% - 4px) * var(--level));
  border-radius: 2px;
  background:
    linear-gradient(180deg, rgba(11,37,11,.6), rgba(11,37,11,.25)),
    repeating-linear-gradient(90deg, rgba(20,64,20,.85) 0, rgba(20,64,20,.85) 6px, rgba(50,96,48,.9) 6px, rgba(50,96,48,.9) 12px);
  box-shadow:
    0 0 6px rgba(139,172,15,.45),
    0 0 12px rgba(155,188,15,.35) inset;
}
.display::after {
  content: "";
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    to bottom,
    rgba(15,56,15,0.08) 0px,
    rgba(15,56,15,0.08) 2px,
    transparent 2px,
    transparent 4px
  );
  pointer-events: none;
}
.display::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(120% 80% at 50% -10%, rgba(255,255,255,.18), transparent 50%),
    radial-gradient(80% 60% at 50% 120%, rgba(0,0,0,.12), transparent 60%);
  mix-blend-mode: screen;
  pointer-events: none;
}
.prev {
  color: rgba(11,37,11,.8);
  font-size: 0.9rem;
  min-height: 1.2em;
  text-align: right;
  user-select: none;
  font-family: Menlo, Consolas, Monaco, ui-monospace, SFMono-Regular, monospace;
  letter-spacing: 0.5px;
}
.curr {
  color: var(--screen-text);
  font-size: clamp(1.8rem, 6vw, 2.6rem);
  letter-spacing: 0.5px;
  text-align: right;
  word-break: break-all;
  font-family: Menlo, Consolas, Monaco, ui-monospace, SFMono-Regular, monospace;
  font-variant-numeric: tabular-nums;
  text-shadow:
    0 1px 0 rgba(255,255,255,.2),
    0 0 6px rgba(155,188,15,.45),
    0 0 14px rgba(139,172,15,.30);
}

.keys {
  padding: 14px 6px 6px;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}
button {
  appearance: none;
  border: 0;
  border-radius: 12px;
  padding: 14px;
  font-size: 1.05rem;
  color: #0c1216;
  background: linear-gradient(180deg, #eceae6, #d8d5cf);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.6),
    inset 0 -2px 0 rgba(0,0,0,.08),
    0 2px 0 rgba(0,0,0,.18);
  cursor: pointer;
  transition: transform .03s ease, filter .1s ease, background .2s ease;
}
button:active { transform: translateY(1px) scale(0.99); }
button:focus-visible { outline: 2px solid var(--gb-dark); outline-offset: 2px; }
button[data-span="2"] { grid-column: span 2; }

.op {
  color: #fff;
  background: linear-gradient(180deg, var(--btn-plum), var(--btn-plum-dark));
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.18),
    inset 0 -2px 0 rgba(0,0,0,.25),
    0 2px 0 rgba(0,0,0,.28);
}
.eq {
  color: #fff;
  background: linear-gradient(180deg, #883c66, #6c2f50);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.18),
    inset 0 -2px 0 rgba(0,0,0,.25),
    0 2px 0 rgba(0,0,0,.28);
}
.fn {
  color: #f0f3f7;
  background: linear-gradient(180deg, #515b69, #3f4753);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.12),
    inset 0 -2px 0 rgba(0,0,0,.25),
    0 2px 0 rgba(0,0,0,.28);
}
.danger { filter: hue-rotate(-10deg) brightness(1.1); }

.footer {
  padding: 8px 6px 6px;
  font-size: 0.78rem;
  color: rgba(0,0,0,.6);
  text-align: center;
  user-select: none;
}

/* Tactility & Wear */
.rubber-button {
  position: relative;
  overflow: hidden;
  transition: transform .06s ease, box-shadow .12s ease, filter .12s ease;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.20),
    inset 0 -3px 6px rgba(0,0,0,.22),
    0 1px 0 rgba(255,255,255,.03);
}
.rubber-button::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(120% 80% at 30% 10%, rgba(255,255,255,.18), transparent 55%),
    linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,0) 40%);
  mix-blend-mode: screen;
  pointer-events: none;
}
.rubber-button::after {
  content: "";
  position: absolute;
  inset: 0;
  opacity: .22;
  border-radius: inherit;
  pointer-events: none;
  mix-blend-mode: multiply;
  background-image:
    url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='1' stitchTiles='stitch'/></filter><rect width='100%' height='100%' filter='url(%23n)' opacity='0.35'/></svg>");
  background-size: 64px 64px;
}
.rubber-button.is-frequent::after {
  background-image:
    radial-gradient(70% 60% at 50% 60%, rgba(0,0,0,.08), transparent 70%),
    url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='1' stitchTiles='stitch'/></filter><rect width='100%' height='100%' filter='url(%23n)' opacity='0.35'/></svg>");
  background-size: 100% 100%, 64px 64px;
}
.rubber-button:active, .rubber-button.is-pressed {
  transform: translateY(1px);
  box-shadow:
    inset 0 2px 6px rgba(0,0,0,.35),
    inset 0 -1px 0 rgba(255,255,255,.08);
  filter: brightness(.98) saturate(.98);
}

.has-3d-effect .keys button.tactile-button {
  position: relative;
  overflow: visible;
  outline: 1px solid rgba(255,255,255,.06);
  outline-offset: -1px;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.16),
    inset 0 -2px 4px rgba(0,0,0,.18),
    0 0 0 2px rgba(0,0,0,.35),
    0 0 0 4px rgba(0,0,0,.12),
    0 3px 6px rgba(0,0,0,.14),
    -1px -1px 0 rgba(255,255,255,.06),
    1px 1px 0 rgba(0,0,0,.05);
}
.has-3d-effect .keys button.tactile-button:active, .has-3d-effect .keys button.tactile-button.is-pressed {
  box-shadow:
    inset 0 2px 7px rgba(0,0,0,.36),
    inset 0 -1px 0 rgba(255,255,255,.05),
    0 0 0 2px rgba(0,0,0,.45),
    0 0 0 4px rgba(0,0,0,.16),
    0 2px 6px rgba(0,0,0,.16),
    -1px -1px 0 rgba(255,255,255,.04);
  filter: brightness(.985) saturate(.99);
}

.has-wear.calc { position: relative; }
.has-wear.calc::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: var(--radius);
  pointer-events: none;
  mix-blend-mode: multiply;
  opacity: .25;
  background-image:
    url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='128' height='128'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='2' stitchTiles='stitch'/></filter><rect width='100%' height='100%' filter='url(%23n)' opacity='0.28'/></svg>");
  background-size: 128px 128px;
}
.has-wear.calc::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: var(--radius);
  pointer-events: none;
  background:
    linear-gradient(180deg, rgba(255,255,255,.06), transparent 35%),
    linear-gradient(90deg, rgba(255,255,255,.04), transparent 30%),
    radial-gradient(60% 50% at 100% 100%, rgba(0,0,0,.06), transparent 60%);
  mix-blend-mode: overlay;
}

.lcd-display {
  background-image:
    linear-gradient(180deg, #b9d269, #9db84a),
    linear-gradient(180deg, rgba(255,255,255,.15), rgba(0,0,0,0));
  background-blend-mode: multiply, normal;
  box-shadow:
    inset 0 0 0 2px rgba(48,98,48,.45),
    inset 0 -10px 16px rgba(0,0,0,.18),
    0 0 14px rgba(146,170,40,.18);
}

/* Chromatic aberration animation (gated) */
@keyframes rgbSplit {
  0%,100% { filter: drop-shadow(0.3px 0 0 rgba(255,0,0,.18)) drop-shadow(-0.3px 0 0 rgba(0,0,255,.18)) drop-shadow(0 0.3px 0 rgba(0,255,0,.12)); }
  25% { filter: drop-shadow(0.4px 0 0 rgba(255,0,0,.21)) drop-shadow(-0.4px 0 0 rgba(0,0,255,.21)) drop-shadow(0 0.4px 0 rgba(0,255,0,.15)); }
  50% { filter: drop-shadow(0.5px 0 0 rgba(255,0,0,.24)) drop-shadow(-0.5px 0 0 rgba(0,0,255,.24)) drop-shadow(0 0.5px 0 rgba(0,255,0,.18)); }
  75% { filter: drop-shadow(0.4px 0 0 rgba(255,0,0,.21)) drop-shadow(-0.4px 0 0 rgba(0,0,255,.21)) drop-shadow(0 0.4px 0 rgba(0,255,0,.15)); }
}
.effects-on .calc { position: relative; animation: rgbSplit 4s ease-in-out infinite; }

.display, .bezel {
  position: relative;
  filter: drop-shadow(0.4px 0 0 rgba(255, 0, 0, 0.24)) drop-shadow(-0.4px 0 0 rgba(0, 0, 255, 0.24)) drop-shadow(0 0.4px 0 rgba(0, 255, 0, 0.18));
}
.display::before, .display::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  border-radius: 10px;
  pointer-events: none;
  z-index: -1;
  mix-blend-mode: screen;
  opacity: 0.4;
}
.display::before { background: inherit; transform: translateX(0.3px); filter: hue-rotate(0deg) saturate(1.1); opacity: 0.12; }
.display::after { background: inherit; transform: translateX(-0.3px); filter: hue-rotate(240deg) saturate(1.1); opacity: 0.12; }

.keys button {
  position: relative;
  filter: drop-shadow(0.2px 0 0 rgba(255, 0, 0, 0.15)) drop-shadow(-0.2px 0 0 rgba(0, 0, 255, 0.15)) drop-shadow(0 0.2px 0 rgba(0, 255, 0, 0.09));
}
.keys button::before, .keys button::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  border-radius: 12px;
  pointer-events: none;
  z-index: -1;
  mix-blend-mode: screen;
  opacity: 0.2;
}
.keys button::before { background: inherit; transform: translateX(0.2px); filter: hue-rotate(0deg) saturate(1.05); opacity: 0.06; }
.keys button::after { background: inherit; transform: translateX(-0.2px); filter: hue-rotate(240deg) saturate(1.05); opacity: 0.06; }

.curr, .prev {
  position: relative;
  filter: drop-shadow(0.3px 0 0 rgba(255, 0, 0, 0.21)) drop-shadow(-0.3px 0 0 rgba(0, 0, 255, 0.21)) drop-shadow(0 0.3px 0 rgba(0, 255, 0, 0.15));
}
.hud, .battery {
  position: relative;
  filter: drop-shadow(0.2px 0 0 rgba(255, 0, 0, 0.18)) drop-shadow(-0.2px 0 0 rgba(0, 0, 255, 0.18)) drop-shadow(0 0.2px 0 rgba(0, 255, 0, 0.12));
}
.hud::before, .hud::after, .battery::before, .battery::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  pointer-events: none;
  z-index: -1;
  mix-blend-mode: screen;
  opacity: 0.3;
}
.hud::before, .battery::before { background: inherit; transform: translateX(0.2px); filter: hue-rotate(0deg) saturate(1.05); opacity: 0.09; }
.hud::after, .battery::after { background: inherit; transform: translateX(-0.2px); filter: hue-rotate(240deg) saturate(1.05); opacity: 0.09; }
.lcd-display .curr, .lcd-display .prev {
  font-family: "Share Tech Mono", Menlo, Consolas, ui-monospace, monospace;
  letter-spacing: 1px;
  text-shadow: 0 1px 0 rgba(255,255,255,.18), 0 0 8px rgba(50,90,30,.35);
}
.lcd-display .curr { font-weight: 700; padding-right: 2px; }

/* Reduced motion: disable animations and heavy effects */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after { animation: none !important; transition: none !important; }
  body::before, body::after, body.effects-on::before, body.effects-on::after { display: none !important; }
  .glbg, .trail { display: none !important; }
}

/* Preserve prior demo rule */
h1 {
  text-decoration: underline;
}
